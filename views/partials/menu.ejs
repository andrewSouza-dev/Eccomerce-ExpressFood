<% const u = (typeof user !== 'undefined' && user) ? user : null; %>


<%- include('head', { title: 'FoodExpress üçΩÔ∏è' }) %>


<nav class="main-nav">

  <!-- LOGO √Ä ESQUERDA -->
  <div class="nav-left">
    <a href="/">
      <img src="/images/logo.png" alt="Logo" class="logo">
    </a>
  </div>

  <!-- LINKS CENTRAIS -->
  <div class="nav-center">
    <% if (u) { %>
      <% if (u.isAdmin) { %>
        <a href="/admin" class="nav-link">Admin</a>
        <a href="/auth/logout" class="nav-link">Sair</a>
      <% } else { %>
        <a href="/home" class="nav-link">In√≠cio</a>
        <a href="/cart" class="nav-link">Carrinho</a>
        <a href="/auth/logout" class="nav-link">Sair</a>
      <% } %>
    <% } else { %>
      <a href="/auth/login" class="nav-link">Login</a>
      <a href="/auth/cadastro" class="nav-link">Cadastro</a>
    <% } %>
  </div>

 <!-- BOT√ÉO VOLTAR √Ä DIREITA -->
<div class="nav-right">
  <a href="#"
     id="btn-voltar"
     class="nav-link voltar"
     onclick="return handleGoBack(event)">
    ‚Üê Voltar
  </a>
</div>

<script>
  // Lista de rotas onde N√ÉO queremos habilitar o "Voltar"
  const NO_BACK_PATHS = ['/auth/login', '/auth/cadastro', '/'];

  function handleGoBack(e) {
    e.preventDefault();

    const path = window.location.pathname;

    // se estiver em uma rota bloqueada => n√£o volta (ou redireciona para /home)
    if (NO_BACK_PATHS.includes(path)) {
      // opcional: redirecionar para home em vez de nada
      // window.location.href = '/home';
      return false;
    }

    // se o hist√≥rico tiver p√°ginas v√°lidas -> volta
    if (window.history.length > 1) {
      // adicional: checar se document.referrer √© da mesma origem ou existe
      try {
        if (document.referrer && new URL(document.referrer).origin === location.origin) {
          window.history.back();
          return false;
        } else if (document.referrer) {
          // se veio de outro dom√≠nio, ainda faz back (ou redireciona)
          window.history.back();
          return false;
        } else {
          // sem referrer -> redireciona pra home (n√£o voltar para lugar estranho)
          window.location.href = '/';
          return false;
        }
      } catch (err) {
        // se erro no URL parsing, apenas tenta voltar
        window.history.back();
        return false;
      }
    } else {
      // hist√≥rico insuficiente -> ir para home (ou n√£o fazer nada)
      window.location.href = '/';
      return false;
    }
  }

  // opcional: deixar o bot√£o visualmente desabilitado nas rotas proibidas
  (function disableOnPaths(){
    const path = window.location.pathname;
    const btn = document.getElementById('btn-voltar');
    if (!btn) return;
    if (['/auth/login','/auth/cadastro','/'].includes(path)) {
      btn.classList.add('disabled');
      btn.setAttribute('aria-disabled', 'true');
      btn.style.pointerEvents = 'none';
      btn.style.opacity = '0.5';
    }
  })();
</script>

</nav>
